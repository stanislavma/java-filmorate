CREATE USER IF NOT EXISTS sm PASSWORD 'password';

CREATE TABLE IF NOT EXISTS genre
(
    id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT
);

CREATE TABLE IF NOT EXISTS mpa
(
    id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT
);

CREATE SEQUENCE IF NOT EXISTS FILM_ID_SEQ START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS film
(
    id           BIGINT DEFAULT NEXTVAL('FILM_ID_SEQ') PRIMARY KEY,
    mpa          BIGINT REFERENCES mpa (id),
    name         TEXT NOT NULL,
    release_date DATE,
    duration     BIGINT,
    description  TEXT
);

CREATE TABLE IF NOT EXISTS film_genre
(
    id       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    film_id  BIGINT REFERENCES film (id) ON DELETE CASCADE,
    genre_id BIGINT REFERENCES genre (id),
    UNIQUE (film_id, genre_id)
);

CREATE SEQUENCE IF NOT EXISTS USER_ID_SEQ START WITH 1 INCREMENT BY 1;
CREATE TABLE IF NOT EXISTS app_user
(
    id       BIGINT DEFAULT NEXTVAL('USER_ID_SEQ') PRIMARY KEY,
    login    TEXT NOT NULL,
    name     TEXT,
    email    TEXT UNIQUE,
    birthday DATE
);

CREATE TABLE IF NOT EXISTS film_user_like
(
    id      BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    film_id BIGINT REFERENCES film (id) ON DELETE CASCADE,
    user_id BIGINT REFERENCES app_user (id) ON DELETE CASCADE,
    UNIQUE (film_id, user_id)
);

CREATE TABLE IF NOT EXISTS user_friendship
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id_one BIGINT REFERENCES app_user (id) ON DELETE CASCADE,
    user_id_two BIGINT REFERENCES app_user (id) ON DELETE CASCADE,
    is_approved BOOLEAN default false,
    UNIQUE (user_id_one, user_id_two)
);